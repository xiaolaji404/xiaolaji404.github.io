<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/xiaolaji.ico"><link rel="icon" href="/img/xiaolaji.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Xiaolaji"><meta name="keywords" content=""><meta name="description" content="Zabbix企业级监控方案 常见监控软件介绍 Cacti   Cacti 是一套基于 PHP、MySQL、SNMP 及 RRD Tool 开发的监测图形分析工具，Cacti 是使用轮询的方式由主服务器向设备发送数据请求来获取设备上状态数据信息的,如果设备不断增多,这个轮询的过程就非常的耗时，轮询的结果就不能即时的反应设备的状态了。Cacti 监控关注的是对数据的展示，却不关注数据异常后的反馈。如果"><meta property="og:type" content="article"><meta property="og:title" content="Zabbix监控系统"><meta property="og:url" content="https://xiaolaji.site/20220905/Zabbix%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/index.html"><meta property="og:site_name" content="星陨的博客"><meta property="og:description" content="Zabbix企业级监控方案 常见监控软件介绍 Cacti   Cacti 是一套基于 PHP、MySQL、SNMP 及 RRD Tool 开发的监测图形分析工具，Cacti 是使用轮询的方式由主服务器向设备发送数据请求来获取设备上状态数据信息的,如果设备不断增多,这个轮询的过程就非常的耗时，轮询的结果就不能即时的反应设备的状态了。Cacti 监控关注的是对数据的展示，却不关注数据异常后的反馈。如果"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xiaolaji.site/Photo/Blog_Photo/index/Zabbix%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.jpg"><meta property="article:published_time" content="2022-09-05T04:29:00.000Z"><meta property="article:modified_time" content="2023-05-27T14:28:08.000Z"><meta property="article:author" content="Xiaolaji"><meta property="article:tag" content="Zabbix"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://xiaolaji.site/Photo/Blog_Photo/index/Zabbix%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>Zabbix监控系统 - 星陨的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"xiaolaji.site",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"0eb40f8e6a255579dc28fb908c7f25f5",google:5113481912,gtag:"G-LVS4PR7N6S",tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"btVVcNFUfRauRrpzv6fApy2i-MdYXbMMI",app_key:"e4z3ib7tRXBdPHQR792zwJft",server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>var _hmt;Fluid.ctx.dnt||(_hmt=_hmt||[],function(){var t=document.createElement("script"),e=(t.src="https://hm.baidu.com/hm.js?0eb40f8e6a255579dc28fb908c7f25f5",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}())</script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.google-analytics.com/analytics.js",function(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","5113481912","auto"),ga("send","pageview")})</script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-LVS4PR7N6S",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-LVS4PR7N6S")})</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="星陨的博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>星陨的博客</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>主页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/Photo/Blog_Photo/Banner/Zabbix%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Zabbix监控系统"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Xiaolaji </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-09-05 12:29" pubdate>September 5, 2022 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 14k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 14 mins </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> views</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="云计算" id="heading-1fefd5a9127ae81cd9e10ebb95084366" role="tab" data-toggle="collapse" href="#collapse-1fefd5a9127ae81cd9e10ebb95084366" aria-expanded="true">云计算 <span class="list-group-count">(3)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-1fefd5a9127ae81cd9e10ebb95084366" role="tabpanel" aria-labelledby="heading-1fefd5a9127ae81cd9e10ebb95084366"><div class="category-post-list"><a href="/20220905/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="Shell脚本编程" class="list-group-item list-group-item-action"><span class="category-post">Shell脚本编程</span> </a><a href="/20220905/Zabbix%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" title="Zabbix监控系统" class="list-group-item list-group-item-action active"><span class="category-post">Zabbix监控系统</span> </a><a href="/20220905/%E4%BA%91%E8%AE%A1%E7%AE%97%E4%BB%8B%E7%BB%8D/" title="云计算介绍" class="list-group-item list-group-item-action"><span class="category-post">云计算介绍</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Zabbix监控系统</h1><div class="markdown-body"><h1>Zabbix企业级监控方案</h1><h1>常见监控软件介绍</h1><h2 id="Cacti">Cacti</h2><ul class="lvl-0"><li class="lvl-2"><p>Cacti 是一套基于 PHP、MySQL、SNMP 及 RRD Tool 开发的监测图形分析工具，Cacti 是使用<strong>轮询</strong>的方式由主服务器向设备发送数据请求来获取设备上状态数据信息的,如果设备不断增多,这个<strong>轮询的过程就非常的耗时</strong>，轮询的结果就不能即时的反应设备的状态了。Cacti 监控关注的是对数据的<strong>展示</strong>，却不关注数据异常后的反馈。如果凌晨 3 点的时候设备的某个数据出现异常，除非监控人员在屏幕前发现这个异常变化，否则是没有任何报警机制能够让我们道出现了异常。</p></li></ul><h2 id="Nagios">Nagios</h2><ul class="lvl-0"><li class="lvl-2"><p>Nagios 是一款<strong>开源</strong>的免费网络监控报警服务,能有效监控 Windows、Linux 和 Unix 的主机状态， 交换机、路由器和防火墙等网络设置，打印机、网络投影、网络摄像等设备。在系统或服务状态异 常时发出邮件或短信报警第一时间通知运维人员，在状态恢复后发出正常的邮件或短信通知。 Nagios 有完善的插件功能,可以方便的根据应用服务扩展功能。</p></li><li class="lvl-2"><p>Nagios 已经可以支持由数万台服务器或上千台网络设备组成的云技术平台的监控,它可以充分发挥 自动化运维技术特点在设备和人力资源减少成本。只是 Nagios <strong>无法将多个相同应用集群</strong>的数据集 合起来,也不能监控到集群中特殊节点的迁移和恢复。</p></li></ul><h2 id="Ganglia">Ganglia</h2><ul class="lvl-0"><li class="lvl-2"><p>Ganglia 是 UC Berkeley 发起的一个开源集群监视项目,设计用于测量数以千计的节点。Ganglia 的 核心包含 gmond、gmetad 以及一个 Web 前端。</p></li><li class="lvl-2"><p>主要是用来监控系统性能,如:CPU 、内存、硬盘利用率, I/O 负载、网络流量情况等,通过曲线很容易 见到每个节点的工作状态,对合理调整、分配系统资源,提高系统整体 性能起到重要作用,目前是监控 HADOOP 的官方推荐服务。</p></li></ul><h2 id="Zabbix">Zabbix</h2><ul class="lvl-0"><li class="lvl-2"><p>Zabbix 是一个基于 <strong>WEB 界面</strong>的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。 zabbix 能监视各种网络参数,保证服务器系统的安全运营;并提供灵活的通知机制以让系统管理员快 速定位/解决存在的各种问题。</p></li><li class="lvl-2"><p>Zabbix 是由 Alexei Vladishev 创建，目前由 Zabbix SIA 在持续开发和支持。</p></li><li class="lvl-2"><p>Zabbix 是一个企业级的分布式开源监控方案。</p></li><li class="lvl-2"><p>Zabbix 是一款能够监控各种网络参数以及服务器健康性和完整性的软件。</p></li><li class="lvl-2"><p>Zabbix 使用灵活的通知机制，允许用户为几乎任何事件配置基于邮件的告警。这样可以快速反馈服务器的问题。基于已存储的数据，Zabbix提供了出色的报告和数据可视化功能。这些功能使得 Zabbix成为容量规划的理想方案。</p></li><li class="lvl-2"><p>Zabbix 支持主动轮询和被动捕获。</p></li><li class="lvl-2"><p>Zabbix所有的报告、统计信息和配置参数都可以通过基于Web的前端页面进行访问。基于Web的 前端页面可以确保您从任何方面评估您的网络状态和服务器的健康性。</p></li><li class="lvl-2"><p>Zabbix是免费的。Zabbix是根据GPL通用公共许可证第2版编写和发行的。这意味着它的源代码都 是免费发行的，可供公众任意使用, 商业支持由Zabbix公司提供。</p></li></ul><h2 id="监控区别">监控区别</h2><ul class="lvl-0"><li class="lvl-2"><p>nagios 图形不是特别好，也可以安装图形插件，但是也不怎么好看</p></li><li class="lvl-2"><p>nagios 一般情况下如果需要图形可以和 cacti 配合使用</p></li><li class="lvl-2"><p>cacti 的监控是轮询监控,效率低，图形相对 nagios 比较好看</p></li><li class="lvl-2"><p>zabbix 和 nagios 因为是并发监控，对 cpu 的要求更高</p></li><li class="lvl-2"><p>zabbix 在性能和功能上都强大很多</p></li><li class="lvl-2"><p>zabbix 的图形相当漂亮</p></li><li class="lvl-2"><p>支持多种监控方式 zabbix-agent snmp 等等</p></li><li class="lvl-2"><p>支持分布式监控,能监控的 agent 非常多</p></li><li class="lvl-2"><p>zabbix 有图形的 web 配置界面，配置简洁</p></li><li class="lvl-2"><p>zabbix 支持自动发现功能</p></li></ul><h1>Zabbix监控简介</h1><h2 id="zabbix优点">zabbix优点</h2><ul class="lvl-0"><li class="lvl-2"><p>开源,无软件成本投入</p></li><li class="lvl-2"><p>Server 对设备性能要求低</p></li><li class="lvl-2"><p>支持设备多,自带多种监控模板</p></li><li class="lvl-2"><p>支持分布式集中管理,有自动发现功能,可以实现自动化监控</p></li><li class="lvl-2"><p>开放式接口,扩展性强,插件编写容易</p></li><li class="lvl-2"><p>当监控的 item 比较多服务器队列比较大时可以采用主动状态,被监控客户端主动 从server 端去下载 需要监控的 item 然后取数据上传到 server 端。 这种方式对服务器的负载比较小。</p></li><li class="lvl-2"><p>Api 的支持,方便与其他系统结合</p></li></ul><h2 id="zabbix缺点">zabbix缺点</h2><p>需在<strong>被监控主机上安装 agent</strong>,所有数据都存在数据库里, 产生的数据很大,瓶颈主要在数据库。</p><p>项目批量修改不方便</p><p>社区虽然成熟，但是中文资料相对较少，服务支持有限;</p><p>入门容易，能实现基础的监控，但是深层次需求需要非常熟悉Zabbix并进行大量的二次定制开发难度较大</p><p>系统级别报警设置相对比较多，如果不筛选的话报警邮件会很多；并且自定义的项目报警需要自己设置，过程比较繁琐；</p><p>缺少数据汇总功能，如无法查看一组服务器平均值，需进行二次开发；</p><h2 id="zabbix组件结构">zabbix组件结构</h2><ul class="lvl-0"><li class="lvl-2"><p>Zabbix_Server：整个监控体系中<strong>最核心</strong>的组件，它负责接收客户端发送的报告信息，所有配置、 统计数据及操作数据都由它组织。</p></li><li class="lvl-2"><p>数据库存储：所有配置信息和Zabbix收集到的数据都被存储在数据库中。</p></li><li class="lvl-2"><p>Web界面：为了从任何地方和任何平台都可以轻松的访问Zabbix, 我们提供基于Web的Zabbix界 面。该界面是 Zabbix Server的一部分，通常跟Zabbix Server运行在同一台物理机器上（！如果使 用SQLite,Zabbix Web界面<strong>必须要跟Zabbix Server运行在同一台物理机器</strong>上。）</p></li><li class="lvl-2"><p>Zabbix_Proxy（<strong>可选</strong>）：用于监控节点非常多的分布式环境中，它可以代理zabbix-server的功 能，减轻zabbixserver的压力。</p></li><li class="lvl-2"><p>Zabbix_Agent：zabbix-agent为客户端软件，用于采集各监控项目的数据，并把采集的数据传输给 zabbixproxy或zabbix-server。</p></li></ul><h2 id="zabbix监控方式">zabbix监控方式</h2><ul class="lvl-0"><li class="lvl-2"><p>被动模式：</p><ul class="lvl-2"><li class="lvl-4">被动检测：相对于agent而言；agent, <strong>server向agent请求获取配置的各监控项相关的数据</strong>， agent接收请求、获取数据并响应给server；</li></ul></li><li class="lvl-2"><p>主动模式</p><ul class="lvl-2"><li class="lvl-4">主动检测：相对于agent而言；agent(active),agent向server请求与自己相关监控项配置，主 动地将server配置的监控项相关的数据发送给server；</li><li class="lvl-4">主动监控能极大节约监控server 的资源。</li></ul></li></ul><h2 id="Zabbix架构">Zabbix架构</h2><p><img src="image-20220814195405290.png" srcset="/img/loading.gif" lazyload alt="架构拓扑图"></p><h2 id="Zabbix常用术语">Zabbix常用术语</h2><ul class="lvl-0"><li class="lvl-2"><p>主机：一台你想监控的网络设备，用IP或域名表示</p></li><li class="lvl-2"><p>主机组：主机的逻辑组；它包含主机和模板。一个主机组里的主机和模板之间并没有任何直接的关联。通常在给不同用户组的主机分配权限时候使用主机组。</p></li><li class="lvl-2"><p>监控项：你想要接收的主机的特定数据，一个度量数据。</p></li><li class="lvl-2"><p>触发器：一个被用于定义问题阈值和“评估”监控项接收到的数据的逻辑表达式当接收到的数据高于 阈值时，触发器从“OK”变成“Problem”状态。当接收到的数据低于阈值时，触发器保留/返回一个 “OK”的状态。</p></li></ul><h1>Zabbix部署</h1><h2 id="安装zabbix-服务端">安装zabbix 服务端</h2><p>参考网址：<a target="_blank" rel="noopener" href="https://www.zabbix.com/cn/download?zabbix=4.0&amp;os_distribution=centos&amp;os_version=7&amp;db=mysql&amp;ws=apache">https://www.zabbix.com/cn/download?zabbix=4.0&amp;os_distribution=centos&amp;os_version=7&amp;db=mysql&amp;ws=apache</a></p><ul class="lvl-0"><li class="lvl-2"><p>准备yum源，安装服务的组件</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-2.el7.noarch.rpm</span><br>[root@server1 ~]<span class="hljs-comment"># yum install zabbix-server-mysql zabbix-web-mysql -y</span><br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>关闭selinux、防火墙</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># setenforce 0</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl stop firewalld</span><br></code></pre></td></tr></table></figure><h2 id="准备数据库">准备数据库</h2><ul class="lvl-0"><li class="lvl-2"><p>安装数据库</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># yum install mariadb-server -y</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl start mariadb</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl enable mariadb</span><br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>创建zabbix用户</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database zabbix character set utf8 collate utf8_bin;<br>mysql&gt; create user zabbix@localhost identified by &#x27;000000&#x27;;<br>mysql&gt; grant all privileges on zabbix.* to zabbix@localhost;<br>mysql&gt; quit;<br></code></pre></td></tr></table></figure><h2 id="修改服务的配置">修改服务的配置</h2><ul class="lvl-0"><li class="lvl-2"><p>导入初始架构数据</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz |</span><br>mysql -uzabbix -D zabbix -p<br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>为zabbix配置数据库</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># vim /etc/zabbix/zabbix_server.conf</span><br>DBPassword=000000<br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>编辑前端php配置</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># vim /etc/httpd/conf.d/zabbix.conf</span><br>php_value max_execution_time 300<br>php_value memory_limit 128M<br>php_value post_max_size 16M<br>php_value upload_max_filesize 2M<br>php_value max_input_time 300<br>php_value always_populate_raw_post_data ‐1<br>php_value date.timezone Asia/Shanghai<br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>启动服务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># systemctl restart zabbix-server httpd</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl enable zabbix-server httpd</span><br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>至此完成zabbix 服务端的部署，可以通过<a target="_blank" rel="noopener" href="http://IP/zabbix%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%8C%E6%88%90%E4%B9%8B%E5%90%8E%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7">http://IP/zabbix进行访问，初始化完成之后使用用户</a> Admin 密码zabbix</p></li></ul><p><img src="image-20220814195833505.png" srcset="/img/loading.gif" lazyload alt="进行登录"></p><p><img src="image-20220814195844163.png" srcset="/img/loading.gif" lazyload alt="修改语言"></p><p><img src="image-20220814195859440.png" srcset="/img/loading.gif" lazyload alt="仪表盘展示"></p><h2 id="客户端配置">客户端配置</h2><ul class="lvl-0"><li class="lvl-2"><p>安装软件包</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-2.el7.noarch.rpm</span><br>[root@server2 ~]<span class="hljs-comment"># yum install zabbix-agent -y</span><br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>关闭selinux、防火墙、启动服务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># setenforce 0</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl stop firewalld</span><br>[root@server1 ~]<span class="hljs-comment"># systemctl start zabbix-agent.service</span><br></code></pre></td></tr></table></figure><h1>快速使用</h1><h2 id="简单监控一个主机">简单监控一个主机</h2><ol><li class="lvl-3"><p>添加一个主机</p></li><li class="lvl-3"><p>添加模板</p></li><li class="lvl-3"><p>添加应用集</p></li><li class="lvl-3"><p>添加监控项</p></li><li class="lvl-3"><p>观察主机是否变绿色</p></li></ol><h2 id="自定义配置监控项">自定义配置监控项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server2 ~]<span class="hljs-comment"># cat /etc/zabbix/zabbix_agentd.d/userparameter_mysql.conf</span><br>UserParameter=nginx_process_num,ps -ef | grep -c nginx<br>[root@server2 ~]<span class="hljs-comment"># systemctl restart zabbix-agent.service</span><br><br><span class="hljs-comment"># 复杂的监控项</span><br>UserParameter=[*]_process_num,ps -ef | grep -c <span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>验证自定义监控项是否生效</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server1 ~]<span class="hljs-comment"># yum install zabbix-get.x86_64 -y</span><br>[root@server1 ~]<span class="hljs-comment"># zabbix_get -s 192.168.175.20 -k nginx_process_num</span><br>9<br></code></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>web端添加监控项，加入此键值</p></li></ul><p><img src="image-20220814200135718.png" srcset="/img/loading.gif" lazyload alt="添加监控项"></p><ul class="lvl-0"><li class="lvl-2"><p>给主机添加触发器</p></li></ul><p><img src="image-20220814200154439.png" srcset="/img/loading.gif" lazyload alt="添加触发器"></p><h2 id="redis相关的自定义监控项">redis相关的自定义监控项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/redis.conf<br>UserParameter=Redis.Status,/usr/local/redis/bin/redis-cli -h 127.0.0.1 -p6379 ping |grep -c PONG<br>UserParameter=Redis_conn[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;connected_clients&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_rss_mem[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_memory_rss&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_lua_mem[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_memory_lua&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_cpu_sys[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_cpu_sys&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_cpu_user[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_cpu_user&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_cpu_sys_cline[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_cpu_sys_children&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_cpu_user_cline[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;used_cpu_user_children&quot;</span> | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>UserParameter=Redis_keys_num[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep -w <span class="hljs-string">&quot;$<span class="hljs-variable">$1</span>&quot;</span> | grep -w <span class="hljs-string">&quot;keys&quot;</span> | grep db<span class="hljs-variable">$3</span> | awk -F<span class="hljs-string">&#x27;=&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F<span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span><br>UserParameter=Redis_loading[*],/usr/local/redis/bin/redis-cli -h <span class="hljs-variable">$1</span> -p <span class="hljs-variable">$2</span> info | grep loading | awk -F<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123;print $$2&#125;&#x27;</span><br><br><br>Redis.Status --检测Redis运行状态， 返回整数<br>Redis_conn --检测Redis成功连接数，返回整数<br>Redis_rss_mem --检测Redis系统分配内存，返回整数<br>Redis_lua_mem --检测Redis引擎消耗内存，返回整数<br>Redis_cpu_sys --检测Redis主程序核心CPU消耗率，返回整数<br>Redis_cpu_user --检测Redis主程序用户CPU消耗率，返回整数<br>Redis_cpu_sys_cline --检测Redis后台核心CPU消耗率，返回整数<br>Redis_cpu_user_cline --检测Redis后台用户CPU消耗率，返回整数<br>Redis_keys_num --检测库键值数，返回整数<br>Redis_loding --检测Redis持久化文件状态，返回整数<br></code></pre></td></tr></table></figure><h2 id="nginx相关的自定义监控项">nginx相关的自定义监控项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/nginx/conf.d/default.conf<br>    location /nginx-status<br>    &#123;<br>        stub_status on;<br>        access_log off;<br>        allow 127.0.0.1;<br>        deny all;<br>    &#125;<br>    <br>    <br>vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/nginx.conf<br>UserParameter=Nginx.active,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | awk <span class="hljs-string">&#x27;/Active/ &#123;print $NF&#125;&#x27;</span><br>UserParameter=Nginx.<span class="hljs-built_in">read</span>,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | grep <span class="hljs-string">&#x27;Reading&#x27;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot; &quot;</span> -f2<br>UserParameter=Nginx.wrie,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | grep <span class="hljs-string">&#x27;Writing&#x27;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot; &quot;</span> -f4<br>UserParameter=Nginx.<span class="hljs-built_in">wait</span>,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | grep <span class="hljs-string">&#x27;Waiting&#x27;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot; &quot;</span> -f6<br>UserParameter=Nginx.accepted,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | awk <span class="hljs-string">&#x27;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $1&#125;&#x27;</span><br>UserParameter=Nginx.handled,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | awk <span class="hljs-string">&#x27;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $2&#125;&#x27;</span><br>UserParameter=Nginx.requests,/usr/bin/curl -s <span class="hljs-string">&quot;http://127.0.0.1:80/nginx-status&quot;</span> | awk <span class="hljs-string">&#x27;/^[ \t]+[0-9]+[ \t]+[0-9]+[ \t]+[0-9]+/ &#123;print $3&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="TCP相关的自定义监控项">TCP相关的自定义监控项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /usr/local/zabbix/share/zabbix/alertscripts/tcp_connection.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">function</span> ESTAB &#123;<br>    /usr/sbin/ss -ant |awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;ESTAB&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>    &#125;<br>    <span class="hljs-keyword">function</span> TIMEWAIT &#123;<br>    /usr/sbin/ss -ant | awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;TIME-WAIT&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> LISTEN &#123;<br>	/usr/sbin/ss -ant | awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;LISTEN&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>&#125;<br><span class="hljs-variable">$1</span><br><br>vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/cattcp.conf<br>UserParameter=tcp[*],/usr/local/zabbix/share/zabbix/alertscripts/tcp_connection.sh <span class="hljs-variable">$1</span><br><br>tcp[TIMEWAIT] --检测TCP的驻留数，返回整数<br>tcp[ESTAB] --检测tcp的连接数、返回整数<br>tcp[LISTEN] --检测TCP的监听数，返回整数<br></code></pre></td></tr></table></figure><h2 id="系统监控的自带选项">系统监控的自带选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">agent.ping 检测客户端可达性、返回nothing表示不可达。1表示可达<br>system.cpu.load --检测cpu负载。返回浮点数<br>system.cpu.util -- 检测cpu使用率。返回浮点数<br>vfs.dev.read -- 检测硬盘读取数据，返回是sps.ops.bps浮点类型，需要定义1024倍<br>vfs.dev.write -- 检测硬盘写入数据。返回是sps.ops.bps浮点类型，需要定义1024倍<br>net.if.out[br0] --检测网卡流速、流出方向，时间间隔为60S<br>net-if-in[br0] --检测网卡流速，流入方向（单位：字节） 时间间隔60S<br>proc.num[] 目前系统中的进程总数，时间间隔60s<br>proc.num[,,run] 目前正在运行的进程总数，时间间隔60S<br><span class="hljs-comment">###处理器信息</span><br>通过zabbix_get 获取负载值<br>合理的控制用户态、系统态、IO等待时间剋保证进程高效率的运行<br>系统态运行时间较高说明进程进行系统调用的次数比较多，一般的程序如果系统态运行时间占用过高就需要优化程序，减少系统调用<br>io等待时间过高则表明硬盘的io性能差，如果是读写文件比较频繁、读写效率要求比较高，可以考虑更换硬盘，或者使用多磁盘做raid的方案<br>system.cpu.swtiches --cpu的进程上下文切换，单位sps，表示每秒采样次数，api中参数<span class="hljs-built_in">history</span>需指定为3<br>system.cpu.intr --cpu中断数量、api中参数<span class="hljs-built_in">history</span>需指定为3<br>system.cpu.load[percpu,avg1] --cpu每分钟的负载值，按照核数做平均值(Processorload (1 min average per core))，api中参数<span class="hljs-built_in">history</span>需指定为0<br>system.cpu.load[percpu,avg5] --cpu每5分钟的负载值，按照核数做平均值(Processorload (5 min average per core))，api中参数<span class="hljs-built_in">history</span>需指定为0<br>system.cpu.load[percpu,avg15] --cpu每5分钟的负载值，按照核数做平均值(Processorload (15 min average per core))，api中参数<span class="hljs-built_in">history</span>需指定为0<br></code></pre></td></tr></table></figure><h2 id="系统监控的自定义监控选项">系统监控的自定义监控选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">###内存相关</span><br>vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/catcarm.conf<br>UserParameter=ram.info[*],/bin/cat /proc/meminfo |awk <span class="hljs-string">&#x27;/^$1:&#123;print $2&#125;&#x27;</span><br>ram.info[Cached] --检测内存的缓存使用量、返回整数，需要定义1024倍<br>ram.info[MemFree] --检测内存的空余量，返回整数，需要定义1024倍<br>ram.info[Buffers] --检测内存的使用量，返回整数，需要定义1024倍<br><br><span class="hljs-comment">####TCP相关的自定义项</span><br>vim /usr/local/zabbix/share/zabbix/alertscripts/tcp_connection.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">function</span> ESTAB &#123;<br>	/usr/sbin/ss -ant |awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;ESTAB&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>&#125;<br><span class="hljs-keyword">function</span> TIMEWAIT &#123;<br>	/usr/sbin/ss -ant | awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;TIME-WAIT&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>&#125;<br><span class="hljs-keyword">function</span> LISTEN &#123;<br>	/usr/sbin/ss -ant | awk <span class="hljs-string">&#x27;&#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> | grep <span class="hljs-string">&#x27;LISTEN&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>&#125;<br><span class="hljs-variable">$1</span><br><br>vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/cattcp.conf<br>UserParameter=tcp[*],/usr/local/zabbix/share/zabbix/alertscripts/tcp_connection.sh <span class="hljs-variable">$1</span><br><br>tcp[TIMEWAIT] --检测TCP的驻留数，返回整数<br>tcp[ESTAB] --检测tcp的连接数、返回整数<br>tcp[LISTEN] --检测TCP的监听数，返回整数<br></code></pre></td></tr></table></figure><h1>zabbix实现邮件告警</h1><ol><li class="lvl-3"><p>配置Email：管理-》报警媒介类型-》Email-》修改对应Email参数</p></li><li class="lvl-3"><p>修改admin用户的报警媒介Email：管理-》用户-》Admin-》报警媒介-》添加接收报警邮件的邮箱-》 点击更新</p></li><li class="lvl-3"><p>添加触发器：配置-》主机-》已监控的主机-》触发器-》创建触发器-》填入报警名称-》点击表达式右 边的添加-》点击监控项右边的选择-》建议选择system uptime(系统启动时间)-》结果选等于0确认插 入-》更新</p></li><li class="lvl-3"><p>查看触发器状态：配置-》主机-》已监控主机里的触发器，找到新创建的触发器-》可以看到触发器对 应的值有问题和状态两种，可能需要等几分钟才会更新过来</p></li><li class="lvl-3"><p>配置发送异常报警邮件：配置-》动作-》点击启用Report problems to Zabbix administrators即可</p></li><li class="lvl-3"><p>邮箱收到报警邮件</p></li></ol><p><img src="image-20220814201031644.png" srcset="/img/loading.gif" lazyload alt="生成授权码"></p><p><img src="image-20220814201039555.png" srcset="/img/loading.gif" lazyload alt="开启邮箱三方授权服务"></p><p><img src="image-20220814201049721.png" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="image-20220814201101952.png" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="image-20220814201109275.png" srcset="/img/loading.gif" lazyload alt=""></p><p><img src="image-20220814201117179.png" srcset="/img/loading.gif" lazyload alt="收信箱展示"></p><p>参考博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/biaopei/p/10535504.html">https://www.cnblogs.com/biaopei/p/10535504.html</a></p><h1>Zabbix通过钉钉告警</h1><p>参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/rightlzc/article/details/100702672">https://blog.csdn.net/rightlzc/article/details/100702672</a></p><p>第一步，是钉钉群聊（这个操作直接在手机上就可以拉群）</p><p>第二步，是添加群机器人（这个操作是需要在电脑端完成，手机没有权限创建机器人）</p><p>第三步，去对应的目录下准备python脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server ~]<span class="hljs-comment"># yum install -y python-requests #脚本中会用到的一个模块</span><br>[root@server alertscripts]<span class="hljs-comment"># pwd</span><br>/usr/lib/zabbix/alertscripts<br>[root@server alertscripts]<span class="hljs-comment"># cat zabbix_send_ding.py</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># Author: xxxxxxxx</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br>headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;<br>api_url = <span class="hljs-string">&quot;https://oapi.dingtalk.com/robot/send？access_token=1a047d0cdc5d0be0a438c73ad0b5e73e25b600173696fd49a2e4c1f352f4bca4&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">msg</span>(<span class="hljs-params">text</span>):<br>    json_text= &#123;<br>    <span class="hljs-string">&quot;msgtype&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;at&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;atMobiles&quot;</span>: [<br>        	<span class="hljs-string">&quot;13333333333&quot;</span><br>        ],<br>        	<span class="hljs-string">&quot;isAtAll&quot;</span>: <span class="hljs-literal">True</span><br>        &#125;,<br>        <span class="hljs-string">&quot;text&quot;</span>: &#123;<br>    		<span class="hljs-string">&quot;content&quot;</span>: text<br>    	&#125;<br>    	&#125;<br>    <span class="hljs-built_in">print</span> requests.post(api_url,json.dumps(json_text),headers=headers).content<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment">#text = &quot;linux + zabbix 天下第一!&quot;</span><br>    text = sys.argv[<span class="hljs-number">1</span>]<br>    msg(text)<br>    <br>[root@server alertscripts]<span class="hljs-comment"># systemctl restart zabbix-server.service</span><br></code></pre></td></tr></table></figure><p>第四步，测试脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@server alertscripts]<span class="hljs-comment"># chmod a+x zabbix_send_ding.py</span><br>[root@server alertscripts]<span class="hljs-comment"># ./zabbix_send_ding.py &quot;linux+zabbix天下第一！&quot;</span><br>&#123;<span class="hljs-string">&quot;errcode&quot;</span>:0,<span class="hljs-string">&quot;errmsg&quot;</span>:<span class="hljs-string">&quot;ok&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>第五步，添加告警媒介</p><p>因为我们使用的python脚本只接收一个参数（内容），所以只需要添加一个参数{ALLERT.MESSAGE}即可</p><p><img src="image-20220814201511893.png" srcset="/img/loading.gif" lazyload alt="设置报警媒介"></p><p>第六步，添加动作</p><p>第七步，绑定用户，用户收件人写电话号码即可</p><p><img src="image-20220814201529716.png" srcset="/img/loading.gif" lazyload alt="进行用户绑定"></p><p>最终实现效果如下图</p><p><img src="image-20220814201555219.png" srcset="/img/loading.gif" lazyload alt="钉钉机器人消息"></p><h1>通过企业微信的机器人提示</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># Author: xxxxxxxx</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br>headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;<br>api_url = <span class="hljs-string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=be88cf0e-ecd8-40a0-999e-7d31f0cb8624&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">msg</span>(<span class="hljs-params">text</span>):<br>        json_text=&#123;<br>    <span class="hljs-string">&quot;msgtype&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;content&quot;</span>: text,<br>            <span class="hljs-comment">#&quot;mentioned_list&quot;:[&quot;吴亚鹏&quot;],</span><br>            <span class="hljs-string">&quot;mentioned_mobile_list&quot;</span>:[<span class="hljs-string">&quot;17623034844&quot;</span>,<span class="hljs-string">&quot;13270559983&quot;</span>]<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">print</span> requests.post(api_url,json.dumps(json_text),headers=headers).content<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>        <span class="hljs-comment">#text = &quot;linux + zabbix 天下第一!&quot;</span><br>        text = sys.argv[<span class="hljs-number">1</span>]<br>        msg(text)<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/" class="category-chain-item">云计算</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Zabbix/">#Zabbix</a></div></div><div class="license-box my-3"><div class="license-title"><div>Zabbix监控系统</div><div>https://xiaolaji.site/20220905/Zabbix监控系统/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Xiaolaji</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>September 5, 2022</div></div><div class="license-meta-item"><div>Licensed under</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/20220905/Python%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="Python的基础知识"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Python的基础知识</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/20220905/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="Shell脚本编程"><span class="hidden-mobile">Shell脚本编程</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.14.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.14.1/waline.min.js",function(){var i=Object.assign({serverURL:"https://api.xiaolaji.site/",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://unpkg.com/@waline/emojis@1.1.0/tw-emoji"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">Views: <span id="busuanzi_value_site_pv"></span> </span><span id="busuanzi_container_site_uv" style="display:none">Visitors: <span id="busuanzi_value_site_uv"></span></span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">苏ICP备2022037338号-1</a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>